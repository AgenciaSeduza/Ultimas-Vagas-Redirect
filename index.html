<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Acesso ao Telegram</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #0e0e0e;
      color: white;
      font-family: 'Poppins', sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 420px;
      margin: 60px auto;
      padding: 20px;
      background-color: #141414;
      border-radius: 14px;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.08);
    }
    img {
      width: 100%;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 10px;
    }
    p {
      color: #cccccc;
      font-size: 15px;
      margin-bottom: 25px;
    }
    .botao {
      display: inline-block;
      background-color: #0088cc;
      color: white;
      text-decoration: none;
      padding: 14px 30px;
      border-radius: 10px;
      font-weight: 600;
      transition: 0.3s;
    }
    .botao:hover {
      background-color: #00aaff;
      transform: scale(1.05);
    }
  </style>

  <!-- TikTok Pixel Code Start (NOVO PIXEL) -->
  <script>
    !function (w, d, t) {
      w.TiktokAnalyticsObject=t;
      var ttq=w[t]=w[t]||[];
      ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"];
      ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};
      for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);
      ttq.instance=function(t){for(var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e};
      ttq.load=function(e,n){
        var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;
        ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};
        n=document.createElement("script");
        n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;
        e=document.getElementsByTagName("script")[0];
        e.parentNode.insertBefore(n,e)
      };
      ttq.load('D47TARJC77UCC4234QU0');
      ttq.page();
    }(window, document, 'ttq');
  </script>
  <!-- TikTok Pixel Code End -->
</head>
<body>
  <div class="container">
    <img src="banner.jpg" alt="Banner promocional">
    <img src="foto.jpg" alt="Instruções de acesso">
    <h1>Acesso ao Telegram</h1>
    <p>Clique no botão abaixo para continuar e entrar no grupo VIP.</p>
    <a id="enter-btn" class="botao" href="https://apextry.com/go/tktkadszona?code=BM2" target="_blank">Entrar agora</a>
  </div>

  <!-- TikTok Events API (Server-Side) - NOVO TOKEN E PIXEL -->
  <script>
    const TIKTOK_PIXEL_ID = 'D47TARJC77UCC4234QU0';
    const TIKTOK_ACCESS_TOKEN = '26d2cf7900b553570942f8b37d79f9c55d3d47d0';
    const API_ENDPOINT = 'https://business-api.tiktok.com/open_api/v1.3/event/track/';

    // Função para gerar event_id único
    function generateEventId(eventName) {
      return `${eventName}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }

    // Função para enviar evento (com content_id válido para VSA)
    async function sendTikTokServerEvent(eventName, extraProps = {}) {
      const baseProps = {
        content_type: 'product',
        content_id: 'VIP_BANNER_001',  // Válido e fixo
        content_name: 'Banner VIP - Vazadinhos das Famosas',
        currency: 'BRL',
        value: 18.00
      };

      const payload = {
        pixel_code: TIKTOK_PIXEL_ID,
        event: eventName,
        event_id: generateEventId(eventName),
        timestamp: new Date().toISOString(),
        context: {
          user_agent: navigator.userAgent,
          ip: '',
          user: {
            external_id: '',
            phone_number: '',
            email: ''
          },
          page: {
            url: window.location.href,
            referrer: document.referrer || ''
          }
        },
        properties: {
          ...baseProps,
          ...extraProps
        }
      };

      // Validação
      if (!payload.properties.content_id || payload.properties.content_id.trim() === '') {
        console.error('[TikTok VSA] content_id inválido!');
        return;
      }

      try {
        const response = await fetch(API_ENDPOINT, {
          method: 'POST',
          headers: {
            'Access-Token': TIKTOK_ACCESS_TOKEN,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        const result = await response.json();
        if (response.ok && result.code === 0) {
          console.log(`[TikTok Server] ${eventName} enviado com sucesso!`);
        } else {
          console.error(`[TikTok Server] Erro ${eventName}:`, result);
        }
      } catch (err) {
        console.error('[TikTok Server] Falha:', err);
      }
    }

    // 1. ViewContent
    window.addEventListener('load', () => {
      sendTikTokServerEvent('ViewContent');
      if (window.ttq) {
        ttq.track('ViewContent', {
          content_id: 'VIP_BANNER_001',
          content_type: 'product',
          value: 18.00,
          currency: 'BRL'
        });
      }
    });

    // 2. ClickButton + CompleteRegistration
    document.getElementById('enter-btn').addEventListener('click', () => {
      sendTikTokServerEvent('ClickButton', { content_name: 'Botão Entrar Agora' });
      sendTikTokServerEvent('CompleteRegistration', { content_name: 'Entrada no Grupo VIP' });

      if (window.ttq) {
        ttq.track('ClickButton', { content_id: 'VIP_BANNER_001' });
        ttq.track('CompleteRegistration', { content_id: 'VIP_BANNER_001' });
      }
    });
  </script>
</body>
</html>
